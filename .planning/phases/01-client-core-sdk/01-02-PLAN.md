---
phase: 01-client-core-sdk
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/client-core/src/threads.ts
  - packages/client-core/src/threads.test.ts
  - packages/client-core/src/client.ts
  - packages/client-core/src/types.ts
  - packages/client-core/src/index.ts
autonomous: true

must_haves:
  truths:
    - "Developer can create a thread with projectId"
    - "Developer can list threads"
    - "Developer can get a thread by ID"
    - "Developer can delete a thread"
    - "Developer can send a message to a thread and get a response"
  artifacts:
    - path: "packages/client-core/src/threads.ts"
      provides: "Thread CRUD and message sending"
      exports: ["ThreadsClient"]
    - path: "packages/client-core/src/types.ts"
      provides: "Thread and message type definitions"
      contains: "Thread"
  key_links:
    - from: "packages/client-core/src/threads.ts"
      to: "packages/client-core/src/client.ts"
      via: "uses TamboClient.fetch for API calls"
      pattern: "this\\.client\\.fetch"
    - from: "packages/client-core/src/client.ts"
      to: "packages/client-core/src/threads.ts"
      via: "exposes threads property"
      pattern: "threads.*ThreadsClient"
---

<objective>
Implement thread CRUD operations and message sending on TamboClient.

Purpose: SDK-02 (thread management) and SDK-03 (send messages, receive responses) — the core data operations before streaming.
Output: TamboClient.threads.create/list/get/delete and TamboClient.threads.sendMessage working with tests.
</objective>

<execution_context>
@/Users/lachlan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lachlan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-client-core-sdk/01-RESEARCH.md
@.planning/phases/01-client-core-sdk/01-01-SUMMARY.md
@apps/api/src/threads/threads.controller.ts (API endpoint shapes)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add thread/message types and implement ThreadsClient</name>
  <files>
    packages/client-core/src/types.ts
    packages/client-core/src/threads.ts
    packages/client-core/src/client.ts
    packages/client-core/src/index.ts
  </files>
  <action>
    First, read apps/api/src/threads/threads.controller.ts to understand the actual API endpoint paths and request/response shapes. Also check the typescript-sdk types at node_modules/@tambo-ai/typescript-sdk/resources/ for Thread and Message types we should align with.

    src/types.ts — Add types (align with typescript-sdk and API shapes):
    - ContentPart: { type: "text"; text: string } | { type: "image_url"; image_url: { url: string } } (match existing SDK)
    - Message: { id: string; role: "user" | "assistant" | "system" | "tool"; content: ContentPart[]; createdAt: string; threadId: string }
    - Thread: { id: string; projectId: string; contextKey?: string; messages: Message[]; createdAt: string; updatedAt: string }
    - CreateThreadParams: { projectId: string; contextKey?: string }
    - SendMessageParams: { content: ContentPart[] | string } (string convenience: auto-wrap in [{type:"text", text: value}])
    - ListThreadsParams: { projectId: string; contextKey?: string; limit?: number; offset?: number }

    src/threads.ts — ThreadsClient class:
    - Constructor takes reference to TamboClient (for fetch method)
    - create(params: CreateThreadParams): Promise<Thread> — POST /threads
    - list(params: ListThreadsParams): Promise<Thread[]> — GET /threads?projectId=...&contextKey=...
    - get(threadId: string): Promise<Thread> — GET /threads/{threadId}
    - delete(threadId: string): Promise<void> — DELETE /threads/{threadId}
    - sendMessage(threadId: string, params: SendMessageParams): Promise<Message> — POST /threads/{threadId}/messages
      - If params.content is string, convert to [{ type: "text", text: params.content }]

    src/client.ts — Add threads property:
    - public readonly threads: ThreadsClient
    - Initialize in constructor: this.threads = new ThreadsClient(this)

    src/index.ts — Add exports:
    - export { ThreadsClient } from "./threads"
    - export type { Thread, Message, ContentPart, CreateThreadParams, SendMessageParams, ListThreadsParams } from "./types"

  </action>
  <verify>
    Run `npm run check-types -w packages/client-core` — no type errors.
  </verify>
  <done>ThreadsClient exists with create/list/get/delete/sendMessage methods, all typed.</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for ThreadsClient</name>
  <files>
    packages/client-core/src/threads.test.ts
  </files>
  <action>
    src/threads.test.ts — Test thread operations by mocking TamboClient.fetch:
    - Test create: calls POST /threads with body, returns Thread
    - Test list: calls GET /threads with query params, returns Thread[]
    - Test get: calls GET /threads/{id}, returns Thread
    - Test delete: calls DELETE /threads/{id}, returns void
    - Test sendMessage with ContentPart[]: calls POST /threads/{id}/messages with content array
    - Test sendMessage with string: auto-wraps string into ContentPart array
    - Test sendMessage returns Message

    Create a mock TamboClient with jest.fn() for the fetch method. Verify correct paths, methods, and body shapes are passed.

  </action>
  <verify>
    Run `npm test -w packages/client-core` — all tests pass.
    Run `npm run build -w packages/client-core` — builds clean.
  </verify>
  <done>All thread CRUD and message tests pass. Developer can create threads, manage them, and send messages through typed API.</done>
</task>

</tasks>

<verification>
- `npm test -w packages/client-core` — all tests pass
- `npm run build -w packages/client-core` — clean build
- ThreadsClient methods call correct API paths with correct HTTP methods
</verification>

<success_criteria>

- TamboClient.threads.create/list/get/delete work with correct API paths
- TamboClient.threads.sendMessage sends messages and returns typed response
- String content auto-converts to ContentPart array
- All operations fully typed with TypeScript inference
  </success_criteria>

<output>
After completion, create `.planning/phases/01-client-core-sdk/01-02-SUMMARY.md`
</output>
