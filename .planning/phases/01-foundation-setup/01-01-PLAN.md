---
phase: 01-foundation-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/next.config.mjs
  - docs/package.json
  - showcase/next.config.mjs
  - packages/core/tsconfig.json
  - packages/db/tsconfig.json
  - packages/backend/tsconfig.json
autonomous: true
requirements:
  - TURBO-03
  - NEXT-04
  - DX-02

must_haves:
  truths:
    - "Next.js apps use webpack mode (not Turbopack) for dev to support transpilePackages"
    - "Internal cloud packages (core, db, backend) are listed in transpilePackages for apps/web"
    - "IDE go-to-definition on imports from workspace packages navigates to source .ts files"
    - "Running turbo dev builds dependencies before starting dev servers"
  artifacts:
    - path: "apps/web/next.config.mjs"
      provides: "transpilePackages config including @tambo-ai-cloud/* packages"
      contains: "@tambo-ai-cloud/core"
    - path: "docs/package.json"
      provides: "dev script without --turbo flag"
  key_links:
    - from: "apps/web/next.config.mjs"
      to: "packages/core/src/index.ts"
      via: "transpilePackages + package.json exports"
      pattern: "transpilePackages.*@tambo-ai-cloud/core"
    - from: "turbo.json"
      to: "apps/web dev task"
      via: "dependsOn: ['^build']"
      pattern: "dependsOn.*\\^build"
---

<objective>
Configure the monorepo foundation for hot reload: ensure all Next.js apps use webpack mode, add internal cloud packages to transpilePackages, and verify TypeScript declaration maps are active for IDE source navigation.

Purpose: Lay the groundwork so Phase 2 (Next.js HMR) and Phase 3 (NestJS restart) can work without config blockers.
Output: Updated Next.js configs, corrected dev scripts, verified tsconfig declarationMap settings.
</objective>

<execution_context>
@/Users/lachlan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lachlan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-RESEARCH.md

# Key source files to read and modify
@apps/web/next.config.mjs
@docs/package.json
@packages/typescript-config/base.json
@turbo.json
@packages/core/tsconfig.json
@packages/db/tsconfig.json
@packages/backend/tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cloud packages to transpilePackages and remove Turbopack from docs</name>
  <files>
    apps/web/next.config.mjs
    docs/package.json
  </files>
  <action>
1. In `apps/web/next.config.mjs`, find the `transpilePackages` array (currently only `["@tambo-ai/ui-registry"]`) and add `@tambo-ai-cloud/core`, `@tambo-ai-cloud/db`, and `@tambo-ai-cloud/backend` to it. Keep `@tambo-ai/ui-registry` in the list.

2. In `docs/package.json`, find the `"dev"` script which currently reads `"next dev --turbo -p 8263"` and remove the `--turbo` flag so it reads `"next dev -p 8263"`. This ensures docs uses webpack mode which respects transpilePackages for monorepo packages (NEXT-04). Turbopack ignores transpilePackages for inter-package dependencies.

Do NOT add `--turbo` to any other dev scripts. apps/web and showcase already use webpack mode (no --turbo flag).
  </action>
  <verify>
- `grep -c "tambo-ai-cloud" apps/web/next.config.mjs` returns 3 (one per package)
- `grep "dev" docs/package.json` does NOT contain `--turbo`
- `npm run check-types` passes from repo root
  </verify>
  <done>
- apps/web transpilePackages includes @tambo-ai-cloud/core, @tambo-ai-cloud/db, @tambo-ai-cloud/backend
- docs dev script uses webpack mode (no --turbo flag)
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify and ensure declarationMap and build ordering are correct</name>
  <files>
    packages/core/tsconfig.json
    packages/db/tsconfig.json
    packages/backend/tsconfig.json
  </files>
  <action>
1. Verify that `packages/typescript-config/base.json` already has `"declarationMap": true` and `"declaration": true`. It does — no changes needed to base config.

2. For each of `packages/core/tsconfig.json`, `packages/db/tsconfig.json`, and `packages/backend/tsconfig.json`:
   - Verify they extend `@tambo-ai/typescript-config/base.json` (or `base`) which provides declarationMap.
   - Ensure none of them override `declarationMap` to `false`.
   - If any package is missing `"declaration": true` in its own compilerOptions AND the base already provides it, that's fine — the base config's `declaration: true` and `declarationMap: true` are inherited.

3. Verify `turbo.json` dev task has `"dependsOn": ["^build"]` — it already does. No changes needed for TURBO-03.

4. Run `npm run check-types` to verify nothing is broken.
5. Run `npm run lint` to verify linting passes.
6. Run `npm test` to verify tests pass.

This task is primarily verification. Only make changes if any of the tsconfig files override declarationMap to false, or if declaration/declarationMap are missing from a package that doesn't inherit from the base config.
  </action>
  <verify>
- `grep -r "declarationMap" packages/typescript-config/base.json` shows `true`
- `npm run check-types` passes
- `npm run lint` passes
- `npm test` passes
  </verify>
  <done>
- All internal packages inherit declarationMap: true from base tsconfig (DX-02)
- Turborepo dev task depends on ^build ensuring builds complete first (TURBO-03)
- All quality checks pass (check-types, lint, test)
  </done>
</task>

</tasks>

<verification>
1. `grep "transpilePackages" apps/web/next.config.mjs` shows all 4 packages listed
2. `grep "dev" docs/package.json` shows no --turbo flag
3. `npm run check-types` passes
4. `npm run lint` passes
5. `npm test` passes
6. `grep "declarationMap" packages/typescript-config/base.json` shows true
7. `grep "dependsOn" turbo.json` confirms dev task has ^build dependency
</verification>

<success_criteria>
- All Next.js apps (web, docs, showcase) use webpack mode for dev (no --turbo)
- apps/web transpilePackages includes @tambo-ai-cloud/core, @tambo-ai-cloud/db, @tambo-ai-cloud/backend
- TypeScript declarationMap enabled via base config inheritance
- Turborepo dev tasks depend on ^build for correct ordering
- All quality checks (check-types, lint, test) pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-01-SUMMARY.md`
</output>
