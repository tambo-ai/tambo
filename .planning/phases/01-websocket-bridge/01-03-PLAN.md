---
phase: 01-websocket-bridge
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - apps/web/app/(authed)/devtools/page.tsx
  - apps/web/app/(authed)/devtools/layout.tsx
  - apps/web/app/(authed)/devtools/components/connection-status.tsx
  - apps/web/app/(authed)/devtools/components/client-card.tsx
autonomous: false

must_haves:
  truths:
    - "Navigating to /devtools in the dashboard shows a connection status indicator"
    - "When an SDK instance with TamboDevTools is running, the dashboard shows it as connected with project ID and SDK version"
    - "When the SDK instance disconnects (e.g., HMR reload), the dashboard shows it disconnect and then reconnect"
    - "When no SDK instances are connected, the dashboard shows an empty state with setup instructions"
    - "The @tambo-ai/react main entry point bundle does not include any devtools code"
  artifacts:
    - path: "apps/web/app/(authed)/devtools/page.tsx"
      provides: "DevTools dashboard page showing connection status and connected clients"
      contains: "useDevtoolsConnection"
    - path: "apps/web/app/(authed)/devtools/layout.tsx"
      provides: "DevTools layout with appropriate page structure"
      contains: "DevTools"
    - path: "apps/web/app/(authed)/devtools/components/connection-status.tsx"
      provides: "Connection indicator showing WS server connection state"
      exports: ["ConnectionStatus"]
    - path: "apps/web/app/(authed)/devtools/components/client-card.tsx"
      provides: "Card component displaying connected SDK client metadata"
      exports: ["ClientCard"]
  key_links:
    - from: "apps/web/app/(authed)/devtools/page.tsx"
      to: "apps/web/app/(authed)/devtools/hooks/use-devtools-connection.ts"
      via: "hook provides isConnected, clients, error state"
      pattern: "useDevtoolsConnection"
    - from: "apps/web/app/(authed)/devtools/components/connection-status.tsx"
      to: "isConnected boolean"
      via: "prop drives visual state (green dot/red dot/yellow dot)"
      pattern: "isConnected"
    - from: "apps/web/app/(authed)/devtools/components/client-card.tsx"
      to: "DevtoolsClient type"
      via: "renders sessionId, sdkVersion, projectId, connectedAt"
      pattern: "DevtoolsClient"
---

<objective>
Build the devtools dashboard page with connection status UI and verify end-to-end: SDK TamboDevTools component connects through the WS server to the dashboard, which displays the connection with metadata. Also verify that the main SDK entry point has zero devtools code in production builds.

Purpose: This is the user-visible proof of the bridge working end-to-end. It covers INFRA-03 (connection status indicator with project ID and SDK version) and validates INFRA-05 (production build isolation). This plan depends on Plan 01 (SDK bridge) and Plan 02 (WS server) both being complete.

Output: Dashboard devtools page at `/devtools` showing connected SDK instances, and a verified production build showing zero devtools contamination.
</objective>

<execution_context>
@/Users/lachlan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lachlan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-websocket-bridge/01-RESEARCH.md

@.planning/phases/01-websocket-bridge/01-01-SUMMARY.md
@.planning/phases/01-websocket-bridge/01-02-SUMMARY.md

@apps/web/app/(authed)/layout.tsx
@apps/web/app/(authed)/(dashboard)/layout.tsx
@apps/web/app/(authed)/devtools/hooks/use-devtools-connection.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create devtools dashboard page with connection status UI</name>
  <files>
    apps/web/app/(authed)/devtools/layout.tsx
    apps/web/app/(authed)/devtools/page.tsx
    apps/web/app/(authed)/devtools/components/connection-status.tsx
    apps/web/app/(authed)/devtools/components/client-card.tsx
  </files>
  <action>
**1. Create `apps/web/app/(authed)/devtools/layout.tsx`:**

A simple layout wrapper for the devtools section. Use the same DashboardThemeProvider pattern from the existing `(dashboard)/layout.tsx`. Keep it minimal:

```tsx
import { DashboardThemeProvider } from "@/providers/dashboard-theme-provider";

export default function DevtoolsLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <DashboardThemeProvider defaultTheme="light">
      <div className="flex min-h-screen flex-col bg-background">
        <div className="container mx-auto px-4 py-6 md:px-6">{children}</div>
      </div>
    </DashboardThemeProvider>
  );
}
```

No `"use client"` needed if there are no client-side hooks in the layout itself. But if DashboardThemeProvider requires it (check), add it. Follow the existing authed layout pattern.

**2. Create `apps/web/app/(authed)/devtools/components/connection-status.tsx`:**

```tsx
"use client";
```

Props: `{ isConnected: boolean, error: string | null }`

Renders a small status indicator:

- Connected: green circle + "Connected to DevTools server"
- Disconnected: red circle + "Disconnected from DevTools server" (+ reconnecting message)
- Error: red circle + error message

Use Tailwind classes. Green: `bg-green-500`, red: `bg-red-500`. Animated pulse on the dot when connected (`animate-pulse`). Use `rounded-full` for the circle. Keep it simple -- a flex row with a 2.5/3 size dot and text.

**3. Create `apps/web/app/(authed)/devtools/components/client-card.tsx`:**

```tsx
"use client";
```

Props: `{ client: DevtoolsClient }` (import type from the hook file).

Renders a card showing:

- Session ID (truncated, monospace font)
- SDK Version (e.g., "v1.0.1")
- Project ID (or "No project ID" in muted text if undefined)
- Connected since (format `connectedAt` timestamp as relative time like "2 min ago" or absolute time)

Use existing shadcn-compatible card patterns from the dashboard. Use Tailwind: `rounded-lg border bg-card p-4 shadow-sm`. Use `font-mono` for session ID. Use `text-muted-foreground` for secondary info.

Keep the relative time formatting simple -- use `Intl.RelativeTimeFormat` or just format as `new Date(connectedAt).toLocaleTimeString()`. Don't add a dependency for this.

**4. Create `apps/web/app/(authed)/devtools/page.tsx`:**

```tsx
"use client";
```

The main devtools page. Uses `useDevtoolsConnection()` hook (from Plan 02).

Layout:

- Page header: "DevTools" heading (use `font-heading text-2xl font-bold`)
- Subheading: "Real-time debugging for your Tambo application" in muted text
- `<ConnectionStatus />` component showing WS server connection
- If connected and clients.length > 0: grid of `<ClientCard />` components (1 col on mobile, 2 on md, 3 on lg using `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`)
- If connected and clients.length === 0: empty state card with:
  - "No SDK instances connected" heading
  - Setup instructions: "Add `<TamboDevTools />` to your app:"
  - Code snippet showing the import and usage (use `bg-muted rounded-md p-4 font-mono text-sm`):

    ```
    import { TamboDevTools } from "@tambo-ai/react/devtools";

    function App() {
      return (
        <TamboProvider apiKey={key}>
          <MyApp />
          <TamboDevTools />
        </TamboProvider>
      );
    }
    ```

- If not connected: just the ConnectionStatus showing disconnected state, plus a note that the devtools server may not be running ("Run `npm run dev:cloud` to start the DevTools server").

**Important:** Do NOT use any complex UI libraries or heavy components. This is a simple status page for Phase 1. It will be enhanced with inspection panels in Phase 2.
</action>
<verify>

1. `npm run build -w apps/web` succeeds (or at least `npm run check-types -w apps/web` passes).
2. With `dev:cloud` running, navigate to `http://localhost:8260/devtools` -- the page loads and shows the connection status.
3. `npm run lint -w apps/web` passes.
4. `npm run build -w react-sdk` succeeds and `ls react-sdk/dist/devtools/ react-sdk/esm/devtools/` confirms subpath build outputs exist.
5. `grep -r "devtools\|partysocket\|DevToolsBridge" react-sdk/dist/index.js react-sdk/esm/index.js` returns zero matches (main entry point is clean -- no devtools contamination).
   </verify>
   <done>
   DevTools dashboard page renders at /devtools, shows connection status to WS server, displays connected SDK client cards with metadata, and shows helpful empty state with setup instructions when no clients are connected. Production build of @tambo-ai/react main entry point contains zero devtools code.
   </done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end connection verification</name>
  <what-built>Complete WebSocket bridge: SDK TamboDevTools component (Plan 01), standalone WS server with connection manager (Plan 02), and devtools dashboard page with connection status UI (Task 1 above). Production build isolation has been verified automatically -- the main @tambo-ai/react entry point contains zero devtools/partysocket references.</what-built>
  <how-to-verify>
1. Start the dev environment: `npm run dev:cloud`
2. Confirm `[DevTools] WebSocket server listening on ws://localhost:8265` appears in terminal output
3. Open `http://localhost:8260/devtools` in a browser -- confirm the page loads and shows "Connected to DevTools server" (green indicator)
4. In a separate terminal, simulate an SDK client connecting:
   ```bash
   node -e "
   const ws = new (require('ws'))('ws://localhost:8265');
   ws.on('open', () => {
     ws.send(JSON.stringify({ type: 'handshake', protocolVersion: 1, sdkVersion: '1.0.1', sessionId: 'test-e2e', projectId: 'proj_test123' }));
     console.log('Handshake sent');
   });
   ws.on('message', (d) => console.log('Received:', d.toString()));
   setTimeout(() => { ws.close(); process.exit(0); }, 10000);
   "
   ```
5. Check the dashboard shows the test client appear as a card with session ID "test-e2e", SDK version "1.0.1", and project ID "proj_test123"
6. After 10 seconds when the test client disconnects, confirm the card disappears from the dashboard
7. With no clients connected, confirm the empty state shows setup instructions with the TamboDevTools code snippet
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Dashboard devtools page loads at /devtools with connection status.
2. SDK client connections are visible on the dashboard with metadata.
3. Client disconnect/reconnect is reflected in the dashboard UI.
4. Empty state shows setup instructions when no clients connected.
5. Production build of @tambo-ai/react main entry has zero devtools code.
6. All linting and type checking passes across affected packages.
</verification>

<success_criteria>

- /devtools page shows "Connected to DevTools server" when WS server is running
- Connected SDK instances appear as cards with session ID, SDK version, project ID, and connection time
- Disconnecting an SDK instance removes its card from the dashboard
- Empty state shows clear setup instructions with code snippet
- `react-sdk/dist/index.js` and `react-sdk/esm/index.js` contain zero references to devtools, partysocket, or DevToolsBridge
- Human has verified end-to-end flow works
  </success_criteria>

<output>
After completion, create `.planning/phases/01-websocket-bridge/01-03-SUMMARY.md`
</output>
