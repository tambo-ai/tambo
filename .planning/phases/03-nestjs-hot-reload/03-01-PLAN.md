---
phase: 03-nestjs-hot-reload
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - turbo.json
  - package.json
autonomous: true
requirements:
  - NEST-01
  - NEST-02
  - NEST-03

must_haves:
  truths:
    - "Editing packages/core/src triggers apps/api server restart automatically"
    - "Editing packages/backend/src triggers apps/api server restart automatically"
    - "Editing packages/db/src triggers apps/api server restart automatically"
  artifacts:
    - path: "turbo.json"
      provides: "Task-specific config for @tambo-ai-cloud/api#dev with interruptible and workspace inputs"
      contains: "@tambo-ai-cloud/api#dev"
    - path: "package.json"
      provides: "dev:cloud script using turbo watch instead of turbo dev"
      contains: "turbo watch"
  key_links:
    - from: "turbo.json @tambo-ai-cloud/api#dev inputs"
      to: "packages/core/src/**, packages/backend/src/**, packages/db/src/**"
      via: "Turborepo input glob matching"
      pattern: "packages/(core|backend|db)/src"
    - from: "package.json dev:cloud"
      to: "turbo watch"
      via: "npm script"
      pattern: "turbo watch dev"
---

<objective>
Configure Turborepo watch mode so editing files in packages/core, packages/backend, or packages/db automatically restarts the NestJS API server.

Purpose: Developers currently must manually restart apps/api when workspace dependencies change. This eliminates that friction.
Output: Updated turbo.json with task-specific api dev config, updated root package.json dev:cloud scripts to use `turbo watch`.
</objective>

<execution_context>
@/Users/lachlan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lachlan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-nestjs-hot-reload/03-RESEARCH.md
@turbo.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add interruptible api dev task with workspace inputs to turbo.json</name>
  <files>turbo.json</files>
  <action>
Add a task-specific override for `@tambo-ai-cloud/api#dev` in turbo.json tasks section. This must:

1. Set `interruptible: true` so turbo watch can restart the task when inputs change
2. Set `cache: false` (dev tasks should not cache)
3. Set `persistent: true` (long-running dev server)
4. Set `dependsOn: ["^build"]` (workspace packages must build first)
5. Add `inputs` array that includes:
   - `"$TURBO_DEFAULT$"` (standard inputs for the package itself)
   - `"../../packages/core/src/**"` (core package source)
   - `"../../packages/backend/src/**"` (backend package source)
   - `"../../packages/db/src/**"` (db package source)

Place it after the existing `@tambo-ai/showcase#dev` entry for consistency.

Do NOT modify the generic `dev` task — it stays as-is for other packages.
</action>
<verify>Read turbo.json and confirm @tambo-ai-cloud/api#dev key exists with interruptible: true and all three package input globs.</verify>
<done>turbo.json contains @tambo-ai-cloud/api#dev task override with interruptible: true and inputs covering packages/core/src, packages/backend/src, and packages/db/src.</done>
</task>

<task type="auto">
  <name>Task 2: Update dev:cloud scripts to use turbo watch</name>
  <files>package.json</files>
  <action>
In the root package.json, update dev:cloud related scripts to use `turbo watch` instead of `turbo dev`:

1. Change `dev:cloud` from `turbo dev --filter=...` to `turbo watch dev --filter=@tambo-ai-cloud/web --filter=@tambo-ai-cloud/api`
2. Change `dev:cloud:full` similarly to use `turbo watch dev --filter=...` with all four filters

This makes `turbo watch` the default for cloud development, enabling automatic restarts when workspace packages change.

Do NOT change `dev:web` or any other dev scripts — only the cloud-specific ones that include the api server.
</action>
<verify>Read root package.json and confirm dev:cloud and dev:cloud:full use `turbo watch dev` instead of `turbo dev`.</verify>
<done>Root package.json dev:cloud and dev:cloud:full scripts use turbo watch, enabling automatic api restart on workspace package changes.</done>
</task>

</tasks>

<verification>
1. `cat turbo.json | grep -A 10 'api#dev'` shows interruptible: true and workspace package inputs
2. `cat package.json | grep 'dev:cloud'` shows `turbo watch dev` in both cloud scripts
3. `npm run lint` passes (no JSON syntax errors)
</verification>

<success_criteria>

- turbo.json has @tambo-ai-cloud/api#dev with interruptible: true and inputs for all three workspace packages
- Root package.json dev:cloud and dev:cloud:full use turbo watch
- No other scripts or configurations are modified
  </success_criteria>

<output>
After completion, create `.planning/phases/03-nestjs-hot-reload/03-01-SUMMARY.md`
</output>
