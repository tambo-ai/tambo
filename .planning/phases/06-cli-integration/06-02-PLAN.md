---
phase: 06-cli-integration
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - cli/src/cli.ts
  - cli/src/commands/init.ts
autonomous: true
requirements:
  - EXEC-03
  - EXEC-04
  - EXEC-05
  - EXEC-06
  - EXEC-07
  - EXEC-08
  - EXEC-09

must_haves:
  truths:
    - "Running `tambo init --magic` triggers the magic init pipeline"
    - "`--magic --yes` auto-approves high-confidence recommendations"
    - "After normal `tambo init` (no --magic), CLI suggests 'Run tambo init --magic to auto-configure components'"
    - "All existing tambo init behavior is preserved — --magic adds to it"
    - "Non-interactive mode without --yes throws GuidanceError with flag suggestions"
  artifacts:
    - path: "cli/src/cli.ts"
      provides: "--magic flag definition and pass-through to handleInit"
      contains: "magic"
    - path: "cli/src/commands/init.ts"
      provides: "--magic suggestion after normal init, magic flag routing"
      contains: "handleMagicInit"
  key_links:
    - from: "cli/src/cli.ts"
      to: "cli/src/commands/init.ts"
      via: "flags.magic passed to handleInit"
    - from: "cli/src/commands/init.ts"
      to: "cli/src/commands/magic-init.ts"
      via: "handleMagicInit() import and call"
---

<objective>
Wire the `--magic` flag into `cli.ts` and `init.ts` so that `tambo init --magic` triggers the magic init pipeline, and normal `tambo init` suggests the flag afterward.

Purpose: This connects the orchestrator (06-01) to the actual CLI entry point so users can run `tambo init --magic`.

Output: Modified `cli.ts` and `init.ts` with --magic flag support
</objective>

<execution_context>
@/Users/lachlan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lachlan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-cli-integration/06-CONTEXT.md
@.planning/phases/06-cli-integration/06-01-SUMMARY.md
@cli/src/cli.ts
@cli/src/commands/init.ts
@cli/src/commands/magic-init.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add --magic flag to CLI and wire into init command</name>
  <files>cli/src/cli.ts, cli/src/commands/init.ts</files>
  <action>
**In `cli/src/cli.ts`:**

1. Add `magic` to the `CLIFlags` interface:

   ```typescript
   magic?: Flag<"boolean", boolean>;
   ```

2. In the meow flags definition, add:

   ```typescript
   magic: {
     type: "boolean",
     description: "Run intelligent auto-configuration",
   },
   ```

3. In the `init` command case (around line 495), pass `magic` flag:
   ```typescript
   await handleInit({
     // ... existing flags
     magic: Boolean(flags.magic),
   });
   ```

**In `cli/src/commands/init.ts`:**

1. Add `magic?: boolean` to `InitOptions` interface

2. Import `handleMagicInit` from `./magic-init.js`

3. At the top of `handleInit()`, before the existing flow, add magic routing:

   ```typescript
   if (magic) {
     return await handleMagicInit({ yes, legacyPeerDeps, skipAgentDocs });
   }
   ```

   This goes right after the `fullSend` check and `validateRootPackageJson()` call — but before the auth flow. Actually, it should be BEFORE validateRootPackageJson since handleMagicInit handles its own validation. Place it right after the non-interactive check block (around line 1100) but before the fullSend check.

   Wait — looking at the code more carefully: the non-interactive GuidanceError block is for when there's no API key and no interactive mode. The magic flag should be checked early. Add it right inside the try block, after the `fullSend` check:

   ```typescript
   try {
     if (fullSend) {
       return await handleFullSendInit({ ... });
     }

     if (magic) {
       return await handleMagicInit({ yes, legacyPeerDeps, skipAgentDocs });
     }

     // ... rest of normal init
   ```

4. After the "Basic initialization complete!" message (around line 1126), add the --magic suggestion:

   ```typescript
   console.log(
     chalk.blue("\n  Tip: Run ") +
       chalk.cyan("tambo init --magic") +
       chalk.blue(" to auto-configure components based on your codebase"),
   );
   ```

   Add this BEFORE the existing "Next steps:" block.

5. Update `showInitHelp()` to mention `--magic` flag in the help text.
   </action>
   <verify>

```bash
npm run check-types -w cli
npm run lint -w cli
npm test -w cli
```

All pass. Verify by reading cli.ts and init.ts that --magic flag is properly wired.
</verify>
<done>`tambo init --magic` routes to handleMagicInit. Normal `tambo init` suggests --magic after completion. All existing init behavior preserved. --magic and --yes flags combine correctly.</done>
</task>

</tasks>

<verification>
```bash
npm run check-types -w cli
npm run lint -w cli
npm test -w cli
```

All pass. The `--magic` flag appears in help output and routes correctly.
</verification>

<success_criteria>

- `--magic` flag defined in cli.ts and passed through to handleInit
- handleInit routes to handleMagicInit when --magic is set
- Normal init suggests --magic after completion
- All existing tests still pass
- --yes flag combines with --magic
  </success_criteria>

<output>
After completion, create `.planning/phases/06-cli-integration/06-02-SUMMARY.md`
</output>
