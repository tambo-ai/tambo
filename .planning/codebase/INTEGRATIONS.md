# External Integrations

**Analysis Date:** 2026-02-11

## APIs & External Services

**Large Language Models (Vercel AI SDK):**

- OpenAI (`@ai-sdk/openai`)
  - Used for: Text generation, function calling, embeddings
  - SDK: openai 6.16.0 + @ai-sdk/openai 2.0.89
  - Auth: `OPENAI_API_KEY` env var
  - Config: `packages/backend/src/services/llm/ai-sdk-client.ts`

- Anthropic Claude (`@ai-sdk/anthropic`)
  - Used for: Text generation with extended thinking
  - SDK: @ai-sdk/anthropic 2.0.60
  - Auth: `ANTHROPIC_API_KEY` env var
  - Config: `packages/backend/src/services/llm/ai-sdk-client.ts`

- Google Gemini (`@ai-sdk/google`)
  - Used for: Text generation and multimodal
  - SDK: @ai-sdk/google 2.0.52
  - Auth: `GOOGLE_AI_API_KEY` env var
  - Config: `packages/backend/src/services/llm/ai-sdk-client.ts`

- Groq (`@ai-sdk/groq`)
  - Used for: Fast inference
  - SDK: @ai-sdk/groq 2.0.34
  - Auth: `GROQ_API_KEY` env var
  - Config: `packages/backend/src/services/llm/ai-sdk-client.ts`

- Mistral AI (`@ai-sdk/mistral`)
  - Used for: Text generation
  - SDK: @ai-sdk/mistral 2.0.27
  - Auth: `MISTRAL_API_KEY` env var
  - Config: `packages/backend/src/services/llm/ai-sdk-client.ts`

- Generic OpenAI-Compatible (`@ai-sdk/openai-compatible`)
  - Used for: Custom LLM endpoints
  - SDK: @ai-sdk/openai-compatible 1.0.32
  - Auth: API key per endpoint
  - Config: `packages/backend/src/services/llm/ai-sdk-client.ts`

**AI Agent Frameworks:**

- AG UI (AG Automation)
  - Used for: Agent framework integrations
  - Packages: @ag-ui/core, @ag-ui/client, @ag-ui/crewai, @ag-ui/llamaindex
  - SDK: ag-ui 0.0.43 (core/client), 0.0.3 (crewai), 0.1.5 (llamaindex)
  - Config: `packages/backend/src/services/`

- Mastra
  - Used for: Agent orchestration
  - SDK: @mastra/core 0.20.2, @mastra/client-js 0.15.2
  - Config: `packages/backend/src/services/decision-loop/`

**Email Service:**

- Resend
  - Used for: Transactional email (welcome, message limits, etc.)
  - SDK: resend 6.9.1
  - Auth: `RESEND_API_KEY` env var
  - Audience management: `RESEND_AUDIENCE_ID` env var
  - SMTP config: `smtp.resend.com:587` for NextAuth email provider
  - Service: `apps/api/src/common/services/email.service.ts`

**LLM Observability & Tracing:**

- Langfuse
  - Used for: LLM usage tracking, cost monitoring, prompt versioning
  - SDK: langfuse 3.38.6
  - Auth: API key + host configuration
  - Config: `packages/backend/src/config/langfuse.config.ts`
  - Integration: Passes telemetry to Vercel AI SDK via `telemetryConfig`

**Error Tracking & Monitoring:**

- Sentry
  - Used for: Exception tracking, performance monitoring, profiling
  - SDK: @sentry/nestjs 10.38.0 (API), @sentry/nextjs 10.38.0 (web)
  - Auth: `SENTRY_DSN` env var
  - Config: `apps/api/src/sentry.ts`, `apps/web/sentry.*.config.ts`
  - Features: Performance tracing (1:1 sampling), profiling, error filtering
  - Integration: Auto-instrumentation of HTTP, database, NestJS

**Analytics & Product Telemetry:**

- PostHog
  - Used for: User analytics, feature tracking, event capture
  - SDK: posthog-node 5.24.9 (server), posthog-js 1.336.4 (client)
  - Auth: `POSTHOG_API_KEY` env var (host: `POSTHOG_HOST`)
  - Service: `apps/api/src/common/services/analytics.service.ts`
  - Features: Optional, degrades gracefully when unconfigured
  - Client-side: `apps/web/lib/analytics.ts`, `showcase/src/providers/posthog-provider.tsx`

## Data Storage

**Databases:**

- PostgreSQL 13+
  - ORM: Drizzle ORM 0.45.1
  - Connection: `DATABASE_URL` (psycopg2 or node-postgres `pg` 8.17.2)
  - Schema: `packages/db/src/schema.ts` (single source of truth)
  - Migrations: `packages/db/migrations/` (generated by drizzle-kit)
  - Features: Row-level security (RLS), policies for multi-tenancy
  - Tools: Drizzle Kit for schema management and migrations

**File Storage:**

- AWS S3 (or S3-compatible)
  - SDK: @aws-sdk/client-s3 3.700.0, @aws-sdk/s3-request-presigner 3.700.0
  - Auth: AWS credentials (IAM or STS)
  - Used for: Component registry, user uploads, artifacts
  - Presigned URLs: Generated via s3-request-presigner for client access

**Caching:**

- Not detected in codebase (reliance on React Query + database queries)
- OpenTelemetry SDK includes optional caching instrumentation

## Authentication & Identity

**Auth Provider:**

- NextAuth.js 4.24.12 (custom implementation)
  - Implementation: JWT strategy (not DB sessions)
  - Adapter: Custom Supabase adapter (`apps/web/lib/nextauth-supabase-adapter.ts`)
  - Session storage: JWT cookies (httpOnly, secure)

**OAuth Providers:**

- GitHub OAuth
  - Env vars: `GITHUB_CLIENT_ID`, `GITHUB_CLIENT_SECRET`
  - Features: Email verification (GitHub API always verifies)

- Google OAuth
  - Env vars: `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`
  - Features: ID token validation, offline access with refresh token
  - Scope: profile, email, openid (allows offline refresh)

**Email-based Auth (Fallback):**

- Email magic link provider (Resend SMTP)
  - Used when OAuth not configured
  - Requires: `RESEND_API_KEY`, `EMAIL_FROM_DEFAULT`
  - Server: `smtp.resend.com:587`

**Authorization & Access Control:**

- Custom guards for API key authentication (`apps/api/src/projects/guards/`)
- Project ownership enforcement via API keys
- Multi-tenancy: Project-scoped data access via RLS policies

**Token Management:**

- JWT signing/verification: `jose` 5.10.0 (OIDC token refresh)
- NextAuth secret: `NEXTAUTH_SECRET` (32 bytes minimum)

## Monitoring & Observability

**Error Tracking:**

- Sentry (primary)
  - Initialization: `apps/api/src/sentry.ts` (before app load)
  - Captures: Exceptions, performance events, profiling
  - Filtering: Health checks excluded
  - Scope tags: service=tambo-cloud, component=api/web

**Logs:**

- Console-based (stdout/stderr)
- Structured logging via Sentry breadcrumbs
- Server-side: NestJS Logger + Sentry integration
- Client-side: Browser console + Sentry errors

**Distributed Tracing:**

- OpenTelemetry 0.211.0
  - Exporters: OTLP HTTP (open standard)
  - Auto-instrumentations: Node.js, Express, HTTP, Postgres
  - Integrations: Langfuse (LLM observability)
  - Config: `apps/api/src/telemetry.ts`

**Metrics & Performance:**

- Langfuse for LLM-specific metrics (tokens, latency, cost)
- Sentry for web/API performance monitoring
- PostHog for feature adoption and user flow analytics

## CI/CD & Deployment

**Hosting:**

- Deployment: Self-hosted (Docker) or cloud platforms (AWS, GCP, Azure)
- Database: Managed PostgreSQL service (required)
- Frontend: Static host with Node.js runtime support for ISR/SSR
- Backend: Node.js 22+ runtime environment

**CI Pipeline:**

- GitHub Actions (inferred from `.github/workflows/`)
- Pre-commit hooks: husky 9.1.7 with lint-staged
- Conventional commits validation (types: feat, fix, perf, deps, etc.)

**Deployment Steps:**

1. Database migrations: `npm run db:migrate -w packages/db`
2. Build packages: `npm run build` (Turborepo)
3. Start services: `npm run dev:cloud` or `npm run start:prod`

## Environment Configuration

**Required env vars:**

```
DATABASE_URL              # PostgreSQL connection
API_KEY_SECRET           # 32-byte hex (openssl rand -hex 32)
PROVIDER_KEY_SECRET      # 32-byte hex
NEXTAUTH_SECRET          # 32-byte hex
NEXTAUTH_URL             # e.g., http://localhost:8260
SENTRY_DSN              # (optional but recommended)
```

**Secrets location:**

- `.env` file (local dev, never committed)
- Environment variables (production deployment)
- Encrypted secrets store (CI/CD: GitHub Secrets)
- No secrets hardcoded in source code
- Env validation schema: `apps/web/lib/env.ts`

**Service Configuration:**

- LLM provider keys: `OPENAI_API_KEY`, `ANTHROPIC_API_KEY`, etc.
- Email: `RESEND_API_KEY`, `RESEND_AUDIENCE_ID`, `EMAIL_FROM_DEFAULT`
- Analytics: `POSTHOG_API_KEY`, `POSTHOG_HOST`
- Auth: `GITHUB_CLIENT_ID/SECRET`, `GOOGLE_CLIENT_ID/SECRET`
- Monitoring: `SENTRY_DSN`, `SENTRY_ENVIRONMENT`
- AWS: AWS credentials (IAM user/role with S3 permissions)

## Webhooks & Callbacks

**Incoming:**

- Registry sync webhooks: `apps/api/src/registry/` (component registry updates)
- OAuth callbacks: `/api/auth/callback/[provider]` (NextAuth)
- Resend email events: (optional, for bounce/complaint handling)
- MCP server endpoints: `POST /mcp` (Model Context Protocol)

**Outgoing:**

- Resend contact subscription: Via `resend.contacts.create()` on user signup
- Sentry error reports: Asynchronous batching
- PostHog event tracking: Batched to PostHog backend
- Langfuse traces: Sent to observability backend
- S3 lifecycle notifications: (optional, for cleanup)

---

_Integration audit: 2026-02-11_
