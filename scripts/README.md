# Component Sync Scripts

This directory contains automation scripts for syncing components across the Tambo monorepo.

## sync-showcase-components.ts

Syncs component files from the CLI registry to the showcase application.

### Features

- **Config-driven**: Reads `config.json` files from `cli/src/registry/{component}/`
- **Banner comments**: Adds auto-sync banners to all copied files with source location
- **Dependency validation**: Validates component dependencies against showcase `package.json`
  - Supports subpath exports (e.g., `@tambo-ai/react/mcp`)
  - Warns about missing dependencies
- **Multiple config formats**: Handles both legacy format (`name`/`content`) and new format (`path`)
- **Watch mode**: Monitors registry for changes and auto-syncs

### Usage

#### One-time sync

```bash
# From monorepo root
npm run sync:showcase

# Or from this directory
npx tsx sync-showcase-components.ts
```

#### Watch mode

```bash
# From monorepo root
npm run sync:showcase:watch

# Or from this directory
npx tsx sync-showcase-components.ts --watch
```

### How It Works

1. **Discovery**: Scans `cli/src/registry/` for component directories with valid `config.json` files
2. **Validation**: Checks component dependencies against `showcase/package.json`
3. **Copying**: Copies each file listed in config to `showcase/src/components/tambo/`
4. **Banner**: Prepends auto-sync banner with metadata
5. **Reporting**: Provides detailed summary of sync results

### Config Format

The script supports two config formats:

#### Legacy Format (name/content)

```json
{
  "name": "form",
  "componentName": "Form",
  "dependencies": ["@tambo-ai/react", "lucide-react"],
  "files": [
    {
      "name": "form.tsx",
      "content": "src/registry/form/form.tsx"
    }
  ]
}
```

#### New Format (path)

```json
{
  "name": "mcp-components",
  "dependencies": ["@tambo-ai/react/mcp", "lucide-react"],
  "files": [
    {
      "path": "components/tambo/mcp-components.tsx"
    }
  ]
}
```

### File Paths

- **Registry**: `cli/src/registry/`
- **Target**: `showcase/src/components/tambo/`
- **Package.json**: `showcase/package.json`

All paths are resolved relative to the monorepo root.

### Banner Format

```typescript
/**
 * THIS FILE IS AUTO-SYNCED FROM CLI REGISTRY
 *
 * Component: {componentName}
 * Source: cli/src/registry/{componentName}/
 *
 * DO NOT EDIT THIS FILE DIRECTLY
 * Make changes in cli/src/registry/{componentName}/ and run sync script
 */
```

### Exit Codes

- `0`: Success
- `1`: Errors during sync (files not found, copy failures)

Note: Missing dependencies produce warnings but don't cause exit code 1.

### Watch Mode Details

Watch mode monitors:

- All `config.json` files in registry
- All `.tsx` and `.ts` files in registry

When changes are detected:

1. Identifies the affected component
2. Re-syncs only that component
3. Reports results

Useful for development when making frequent changes to registry components.
